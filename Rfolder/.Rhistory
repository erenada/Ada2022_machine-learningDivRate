logTransforms = c(TRUE,TRUE,FALSE),
delta = c(1,1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
samplesMassExtinctionBD <- tess.mcmc(likelihoodFunction = likelihoodMassExtinctionBD,
priors = ext_priorsMassExtinctionBD,
parameters = c(runif(2,0,1),max(times)*3/4),
logTransforms = c(TRUE,TRUE,FALSE),
delta = c(1,1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
marginalLikelihoodMassExtinctionBD <- tess.steppingStoneSampling(
likelihoodFunction = likelihoodMassExtinctionBD,
priors = priorsMassExtinctionBD,
parameters = c(runif(2,0,1),max(times)*3/4),
logTransforms = c(TRUE,TRUE,FALSE),
iterations = 1000,
burnin = 100,
K = 50)
marginalLikelihoodMassExtinctionBD <- tess.steppingStoneSampling(
likelihoodFunction = likelihoodMassExtinctionBD,
priors = ext_priorsMassExtinctionBD,
parameters = c(runif(2,0,1),max(times)*3/4),
logTransforms = c(TRUE,TRUE,FALSE),
iterations = 1000,
burnin = 100,
K = 50)
candidateModels <- c("ConstBD"=marginalLikelihoodConstBD,
"DecrBD"=marginalLikelihoodDecrBD,
"EpisodicBD"=marginalLikelihoodEpisodicBD,
"MassExtinctionBD"=marginalLikelihoodMassExtinctionBD)
marginalLikelihoodGrid <- expand.grid(M0=names(candidateModels),
M1=names(candidateModels))
marginalLikelihoodGrid$BF <- 2 * (candidateModels[marginalLikelihoodGrid$M0] - candidateModels[marginalLikelihoodGrid$M1])
marginalLikelihoodGrid <- marginalLikelihoodGrid[order(marginalLikelihoodGrid$BF, decreasing=TRUE),]
marginalLikelihoodGrid
sim1_tree_object <- read.tree("../UltrametricTrees/Dataset1/s_tree.trees")
true_tree_object <- read.tree("../UltrametricTrees/Dataset1/s_tree.trees")
plot(true_tree_object)
is.ultrametric(true_tree_object)
true_tree_times <- as.numeric( branching.times(true_tree_object) )
prior_delta <- function(x) { dexp(x,rate=10.0,log=TRUE) }
prior_tau <- function(x) { dexp(x,rate=10.0,log=TRUE) }
priorsConstBD <- c("diversification"=prior_delta,
"turnover"=prior_tau)
true_tree_likelihoodConstBD <- function(params) { speciation <- params[1] + params[2]
extinction <- params[2]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
true_tree_samplesConstBD <- tess.mcmc(likelihoodFunction = true_tree_likelihoodConstBD,
priors = priorsConstBD,
parameters = runif(2,0,1),
logTransforms = c(TRUE,TRUE),
delta = c(1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
summary(samplesConstBD)
summary(samplesConstBD)
plot(samplesConstBD)
true_tree_samplesConstBD <- tess.mcmc(likelihoodFunction = true_tree_likelihoodConstBD,
priors = priorsConstBD,
parameters = runif(2,0,1),
logTransforms = c(TRUE,TRUE),
delta = c(1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
prior_delta <- function(x) { dexp(x,rate=10.0,log=TRUE) }
prior_tau <- function(x) { dexp(x,rate=10.0,log=TRUE) }
priorsConstBD <- c("diversification"=prior_delta,
"turnover"=prior_tau)
true_tree_likelihoodConstBD <- function(params) { speciation <- params[1] + params[2]
extinction <- params[2]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
true_tree_likelihoodConstBD <- function(params) { speciation <- params[1] + params[2]
extinction <- params[2]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
true_tree_samplesConstBD <- tess.mcmc(likelihoodFunction = true_tree_likelihoodConstBD,
priors = priorsConstBD,
parameters = runif(2,0,1),
logTransforms = c(TRUE,TRUE),
delta = c(1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
summary(true_tree_samplesConstBD)
plot(true_tree_samplesConstBD)
library(geiger)
rescale(true_tree_object, model = "depth", 1)
test_true_tree_object <- rescale(true_tree_object, model = "depth", 1)
plot()
plot(test_true_tree_object)
View(test_true_tree_object)
test_true_tree_object[["edge.length"]]
plot(samplesMassExtinctionBD)
plot(samplesEpisodicBD)
plot(samplesEpisodicBD)
plot(samplesDecrBD)
is.ultrametric(true_tree_object)
true_tree_times <- as.numeric( branching.times(true_tree_object) )
true_prior_delta <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_tau <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_priorsConstBD <- c("diversification"=prior_delta,
"turnover"=prior_tau)
true_prior_delta <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_tau <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_priorsConstBD <- c("diversification"=true_prior_delta,
"turnover"=true_prior_tau)
true_tree_likelihoodConstBD <- function(params) { speciation <- params[1] + params[2]
extinction <- params[2]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
true_tree_samplesConstBD <- tess.mcmc(likelihoodFunction = true_tree_likelihoodConstBD,
priors = true_priorsConstBD,
parameters = runif(2,0,1),
logTransforms = c(TRUE,TRUE),
delta = c(1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
summary(true_tree_samplesConstBD)
plot(true_tree_samplesConstBD)
true_tree_object <- test_true_tree_object
plot(true_tree_object)
is.ultrametric(true_tree_object)
true_tree_times <- as.numeric( branching.times(true_tree_object) )
true_prior_delta <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_tau <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_priorsConstBD <- c("diversification"=true_prior_delta,
"turnover"=true_prior_tau)
true_tree_likelihoodConstBD <- function(params) { speciation <- params[1] + params[2]
extinction <- params[2]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
true_tree_samplesConstBD <- tess.mcmc(likelihoodFunction = true_tree_likelihoodConstBD,
priors = true_priorsConstBD,
parameters = runif(2,0,1),
logTransforms = c(TRUE,TRUE),
delta = c(1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
summary(true_tree_samplesConstBD)
plot(true_tree_samplesConstBD)
const_prior_delta <- function(x) { dexp(x,rate=0.1,log=TRUE) }
const_prior_lambda <- function(x) { dexp(x,rate=10.0,log=TRUE) }
const_prior_alpha <- function(x) { dexp(x,rate=0.1,log=TRUE) }
const_priorsDecrBD <- c("turnover"=prior_delta,
"initial speciation"=prior_lambda,
"speciation decay"=prior_alpha)
const_likelihoodDecrBD <- function(params) {
speciation <- function(t) params[1] + params[2] * exp(-params[3]*t)
extinction <- function(t) params[1]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
const_prior_delta <- function(x) { dexp(x,rate=0.1,log=TRUE) }
const_prior_lambda <- function(x) { dexp(x,rate=10.0,log=TRUE) }
const_prior_alpha <- function(x) { dexp(x,rate=0.1,log=TRUE) }
const_prior_delta <- function(x) { dexp(x,rate=0.1,log=TRUE) }
const_prior_lambda <- function(x) { dexp(x,rate=10.0,log=TRUE) }
const_prior_alpha <- function(x) { dexp(x,rate=0.1,log=TRUE) }
const_priorsDecrBD <- c("turnover"=const_prior_delta,
"initial speciation"=const_prior_lambda,
"speciation decay"=const_prior_alpha)
const_likelihoodDecrBD <- function(params) {
speciation <- function(t) params[1] + params[2] * exp(-params[3]*t)
extinction <- function(t) params[1]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
true_decr_prior_delta <- function(x) { dexp(x,rate=0.1,log=TRUE) }
true_decr_prior_lambda <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_decr_prior_alpha <- function(x) { dexp(x,rate=0.1,log=TRUE) }
true_decr_priorsDecrBD <- c("turnover"=const_prior_delta,
"initial speciation"=const_prior_lambda,
"speciation decay"=const_prior_alpha)
true_decr_prior_delta <- function(x) { dexp(x,rate=0.1,log=TRUE) }
true_decr_prior_lambda <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_decr_prior_alpha <- function(x) { dexp(x,rate=0.1,log=TRUE) }
true_decr_priorsDecrBD <- c("turnover"=true_decr_prior_delta,
"initial speciation"=true_decr_prior_lambda,
"speciation decay"=true_decr_prior_alpha)
true_decr_likelihoodDecrBD <- function(params) {
speciation <- function(t) params[1] + params[2] * exp(-params[3]*t)
extinction <- function(t) params[1]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
true_decr_samplesDecrBD <- tess.mcmc(likelihoodFunction = true_tree_samplesConstBD,
priors = true_decr_priorsDecrBD,
parameters = runif(3,0,1),
logTransforms = c(TRUE,TRUE,TRUE),
delta = c(1,1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
true_decr_samplesDecrBD <- tess.mcmc(likelihoodFunction = true_decr_priorsDecrBD,
priors = true_decr_priorsDecrBD,
parameters = runif(3,0,1),
logTransforms = c(TRUE,TRUE,TRUE),
delta = c(1,1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
library(TESS)
true_decr_samplesDecrBD <- tess.mcmc(likelihoodFunction = true_decr_likelihoodDecrBD,
priors = true_decr_priorsDecrBD,
parameters = runif(3,0,1),
logTransforms = c(TRUE,TRUE,TRUE),
delta = c(1,1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
true_prior_delta_before <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_tau_before <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_delta_after <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_tau_after <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_priorsEpisodicBD <- c("diversification before"=prior_delta_before,
"turnover before"=prior_tau_before,
"diversification after"=prior_delta_after,
"turnover after"=prior_tau_after)
true_prior_delta_before <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_tau_before <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_delta_after <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_tau_after <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_priorsEpisodicBD <- c("diversification before"=true_prior_delta_before,
"turnover before"=true_prior_tau_before,
"diversification after"=true_prior_delta_after,
"turnover after"=true_prior_tau_after)
rateChangeTime <- max( true_tree_times ) / 2
true_rateChangeTime <- max( true_tree_times ) / 2
true_prior_delta_before <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_tau_before <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_delta_after <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_prior_tau_after <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_priorsEpisodicBD <- c("diversification before"=true_prior_delta_before,
"turnover before"=true_prior_tau_before,
"diversification after"=true_prior_delta_after,
"turnover after"=true_prior_tau_after)
true_likelihoodEpisodicBD <- function(params) {
speciation <- c(params[1]+params[2],params[3]+params[4])
extinction <- c(params[2],params[4])
lnl <- tess.likelihood.rateshift(true_tree_times,
lambda = speciation,
mu = extinction,
rateChangeTimesLambda = true_rateChangeTime,
rateChangeTimesMu = true_rateChangeTime,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
true_samplesEpisodicBD <- tess.mcmc(likelihoodFunction = true_likelihoodEpisodicBD,
priors = true_priorsEpisodicBD,
parameters = runif(4,0,1),
logTransforms = c(TRUE,TRUE,TRUE,TRUE),
delta = c(1,1,1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
summary(true_samplesEpisodicBD)
plot(true_samplesEpisodicBD)
# Birth-death processes with explicit mass-extinction events
survivalProbability <- 0.1
true_ME_prior_delta <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_ME_prior_tau <- function(x) { dexp(x,rate=10.0,log=TRUE) }
true_ME_prior_time <- function(x) { dunif(x,min=max(times)/2,max=max(times),log=TRUE)}
true_ME_priorsMassExtinctionBD <- c("diversification"=true_ME_prior_delta,
"turnover"=true_ME_prior_tau,
"mass-extinction time"=true_ME_prior_time)
true_ME_likelihoodMassExtinctionBD <- function(params) {
speciation <- params[1]+params[2]
extinction <- params[2]
time <- params[3]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
massExtinctionTimes = time,
massExtinctionSurvivalProbabilities = survivalProbability,
samplingProbability = 1.0,
log = T)
return(lnl)
}
true_ME_likelihoodMassExtinctionBD <- function(params) {
true_ME_speciation <- params[1]+params[2]
true_ME_extinction <- params[2]
true_time <- params[3]
lnl <- tess.likelihood(true_tree_times,
lambda = speciation,
mu = extinction,
massExtinctionTimes = true_time,
massExtinctionSurvivalProbabilities = survivalProbability,
samplingProbability = 1.0,
log = T)
return(lnl)
}
true_samplesMassExtinctionBD <- tess.mcmc(likelihoodFunction = true_ME_likelihoodMassExtinctionBD,
priors = true_ME_priorsMassExtinctionBD,
parameters = c(runif(2,0,1),max(times)*3/4),
logTransforms = c(TRUE,TRUE,FALSE),
delta = c(1,1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
true_ME_likelihoodMassExtinctionBD <- function(params) {
true_ME_speciation <- params[1]+params[2]
true_ME_extinction <- params[2]
true_time <- params[3]
lnl <- tess.likelihood(true_tree_times,
lambda = true_ME_speciation,
mu = true_ME_extinction,
massExtinctionTimes = true_time,
massExtinctionSurvivalProbabilities = survivalProbability,
samplingProbability = 1.0,
log = T)
return(lnl)
}
true_samplesMassExtinctionBD <- tess.mcmc(likelihoodFunction = true_ME_likelihoodMassExtinctionBD,
priors = true_ME_priorsMassExtinctionBD,
parameters = c(runif(2,0,1),max(times)*3/4),
logTransforms = c(TRUE,TRUE,FALSE),
delta = c(1,1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
summary(samplesMassExtinctionBD)
plot(samplesMassExtinctionBD)
true_marginalLikelihoodConstBD <- tess.steppingStoneSampling(
likelihoodFunction = true_tree_likelihoodConstBD,
priors = true_priorsConstBD,
parameters = runif(2,0,1),
logTransforms = c(TRUE,TRUE),
iterations = 1000,
burnin = 100,
K = 50)
marginalLikelihoodDecrBD <- tess.steppingStoneSampling(
likelihoodFunction = true_decr_likelihoodDecrBD,
priors = true_decr_priorsDecrBD,
parameters = runif(3,0,1),
logTransforms = c(TRUE,TRUE,TRUE),
iterations = 1000,
burnin = 100,
K = 50)
marginalLikelihoodEpisodicBD <- tess.steppingStoneSampling(
likelihoodFunction = true_samplesEpisodicBD,
priors = true_priorsEpisodicBD,
parameters = runif(4,0,1),
logTransforms = c(TRUE,TRUE,TRUE,TRUE),
iterations = 1000,
burnin = 100,
K = 50)
marginalLikelihoodEpisodicBD <- tess.steppingStoneSampling(
likelihoodFunction = true_samplesEpisodicBD,
priors = true_priorsEpisodicBD,
parameters = runif(4,0,1),
logTransforms = c(TRUE,TRUE,TRUE,TRUE),
iterations = 1000,
burnin = 100,
K = 50)
library(TESS)
marginalLikelihoodEpisodicBD <- tess.steppingStoneSampling(
likelihoodFunction = true_likelihoodEpisodicBD,
priors = true_priorsEpisodicBD,
parameters = runif(4,0,1),
logTransforms = c(TRUE,TRUE,TRUE,TRUE),
iterations = 1000,
burnin = 100,
K = 50)
candidateModels <- c("ConstBD"=true_marginalLikelihoodConstBD,
"DecrBD"=marginalLikelihoodDecrBD,
"EpisodicBD"=marginalLikelihoodEpisodicBD,
"MassExtinctionBD"=marginalLikelihoodMassExtinctionBD)
marginalLikelihoodGrid <- expand.grid(M0=names(candidateModels),
M1=names(candidateModels))
marginalLikelihoodGrid$BF <- 2 * (candidateModels[marginalLikelihoodGrid$M0] - candidateModels[marginalLikelihoodGrid$M1])
marginalLikelihoodGrid <- marginalLikelihoodGrid[order(marginalLikelihoodGrid$BF, decreasing=TRUE),]
marginalLikelihoodGrid
plot(true_tree_object)
best800tree <- read.tree("../UltrametricTrees/Dataset1/inference_fong_best800.txt.treefile")
plot(best800tree)
plot(true_tree_object)
inferred_tree_object <- read.tree("../UltrametricTrees/Dataset1/inferenceTest.treefile")
plot(inferred_tree_object)
plot(inferred_tree_object)
plot(true_tree_object)
inferred_tree_times <- as.numeric( branching.times(inferred_tree_object) )
inferred_prior_delta <- function(x) { dexp(x,rate=10.0,log=TRUE) }
inferred_prior_tau <- function(x) { dexp(x,rate=10.0,log=TRUE) }
plot(true_tree_object)
is.ultrametric(inferred_tree_object)
inferred_tree_times <- as.numeric( branching.times(inferred_tree_object) )
inferred_prior_delta <- function(x) { dexp(x,rate=10.0,log=TRUE) }
inferred_prior_tau <- function(x) { dexp(x,rate=10.0,log=TRUE) }
inferred_priorsConstBD <- c("diversification"=inferred_prior_delta,
"turnover"=inferred_prior_tau)
inferred_tree_likelihoodConstBD <- function(params) { speciation <- params[1] + params[2]
extinction <- params[2]
lnl <- tess.likelihood(inferred_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
inferred_tree_samplesConstBD <- tess.mcmc(likelihoodFunction = inferred_tree_likelihoodConstBD,
priors = inferred_priorsConstBD,
parameters = runif(2,0,1),
logTransforms = c(TRUE,TRUE),
delta = c(1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
summary(inferred_tree_samplesConstBD)
plot(inferred_tree_samplesConstBD)
inferred_decr_prior_lambda <- function(x) { dexp(x,rate=10.0,log=TRUE) }
inferred_decr_prior_alpha <- function(x) { dexp(x,rate=0.1,log=TRUE) }
inferred_decr_prior_delta <- function(x) { dexp(x,rate=0.1,log=TRUE) }
inferred_decr_prior_lambda <- function(x) { dexp(x,rate=10.0,log=TRUE) }
inferred_decr_prior_alpha <- function(x) { dexp(x,rate=0.1,log=TRUE) }
inferred_decr_priorsDecrBD <- c("turnover"=inferred_decr_prior_delta,
"initial speciation"=inferred_decr_prior_lambda,
"speciation decay"=inferred_decr_prior_alpha)
inferred_decr_likelihoodDecrBD <- function(params) {
speciation <- function(t) params[1] + params[2] * exp(-params[3]*t)
extinction <- function(t) params[1]
lnl <- tess.likelihood(inferred_tree_times,
lambda = speciation,
mu = extinction,
samplingProbability = 1.0,
log = TRUE)
return(lnl)
}
inferred_decr_samplesDecrBD <- tess.mcmc(likelihoodFunction = inferred_decr_likelihoodDecrBD,
priors = inferred_decr_priorsDecrBD,
parameters = runif(3,0,1),
logTransforms = c(TRUE,TRUE,TRUE),
delta = c(1,1,1),
iterations = 10000,
burnin = 1000,
thinning = 10,
adaptive = TRUE,
verbose = TRUE)
